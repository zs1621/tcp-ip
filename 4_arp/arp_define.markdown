##why arp
 - 数据链路如以太网或令牌网都由自己的寻址机制(常为48bit),
 - 当一台主机把以太网数据发送到同一局域网的另一台主机时，是根据48bit的以太网地址来确定目的地址
 - 设备驱动从不检查ip数据报中的目的IP地址
 - 为了找到ip对应的硬件地址 
 - 需要apr做个翻译

###功能

 - ARP 的功能是在32bit的IP地址和采用不同网络技术的硬件地址间提供动态映射

##一个例子

###在命令行输入`ftp bsdi`,步骤如下
 
![png](http://iworkout.cn/static/test/blog/arp.png)



对照上图的步骤说明如下

 - 应用程序FTP客户端调用函数gethostbyname把主机名转换为32为IP地址(DNS的功能，后面讨论)

 - FTP客户端请求TCP用得到的IP地址建立连接

 - TCP发送一个连接请求分段到远端的主机, 即用上述IP地址发送一份IP数据报

 - 如果目的主机在本地网络中(以太网、令牌环网..), 那么IP数据报可以直接送到目的主机上。如果目的主机在一个远程网络上，那么就通过IP选路函数来确定位于本地网络的下一站路由器地址， 并让它转发IP数据报。不管哪种情况， IP数据报都被送到位于本地网络上的一台主机或路由器。

 - 假定是一个以太网，那么发送端主机必须把32bit的IP地址变成48bit的以太网地址。从逻辑Internet地址到对应的物理硬件地址需要进行翻译。这就是ARP的功能。

 - ARP发送一份称作ARP请求的以太网数据帧给以太网的每个主机。 广播给同一网络的所有主机(路由器)。 ARP请求数据帧中包含目的主机的IP地址，其意思是“如果你是这个IP地址的拥有者，请回答你的硬件地址”.

 - 目的主机的ARP层收到这份广播后， 识别出这时发送端在寻问它的IP地址，于是发送一个ARP应答。这个APR应答包含IP地址及对应的硬件地址

 - 收到ARP应答后，使ARP进行请求回的应答交换的IP数据报现在就可以传送了

 - 发送IP数据报到目的主机


 > ps 点对点链路不适用ARP 



##ARP高速缓存

 - ARP高效运行的关键是由于每个主机上都由以个ARP高速缓存,  ip 和对应硬件地址记录

 - `arp -a`： 查看ARP缓存内容

