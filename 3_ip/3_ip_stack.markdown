##ip数据报内容


如图

![png](http://iworkout.cn/static/test/blog/ip_stack.png)


为了清楚， 用wireshark抓了已例子  关于ip数据包

![png](http://iworkout.cn/static/test/blog/ip_protocol.png)


对照上面两个图,具体说明


 - 版本号（4位）: ip版本 
 - 首部长度 (4 位): 一般来说是20字节
 - 服务类型（TOS 8位）: 可以用tcpdump命令来解释(TODO) 
 - 16位总长度: 整个ip数据报的长度， 字节为单位.由于16bit，能表示的最大值为65535。所以ip数据报最长可达 65535字节。当然，其长度是根据内容决定的。 
 - 16位标识符字段: 唯一标识主机发送的每一分数据 
 - 3位标志和13位片偏移: 用于分片 (TODO)
 - TTL(8位): 设置了数据报可以经过的最多路有数。每经过一个路由器值减1.当该字段值位0， 数据报就被丢弃， 并发送ICMP报文通知源主机
 - 协议字段(8位): 识别是哪个协议向IP传送数据
 - 首部检验和字段:  
   - 发送数据时， 为了计算IP数据包的检验和
   - 首先ip数据包的检验和字段置 0
   - 把首部堪称以16位为单位的数字组成， 一次进行二进制反码求和；
   - 把得到的结果存入检验和字段
   - 接收数据时， 计算数据包的检验和:
   - 把首部看成16位为单位的数字组成， 依次进行二进制反码求和 ,*包括检验和字段*
   - 检查计算出的检验和的结果是否是1， 是1就是正确的， 否则就是错误的 [计算过程](http://www.educity.cn/windows/339670.html) 
 - 32位源地址: ip发送方
 - 32位目地地址: ip接收方
 - 选项: 数据报中位一个可变长的可选信息。一般很少用， 就不做介绍了

